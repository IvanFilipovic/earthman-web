{"version":3,"file":"AppNavigation-CXvNTMsr.js","sources":["../../../../virtual:public?%2Flogo%2Fearth-man920.png","../../../../composables/useCart.ts","../../../../components/AppNavigation.vue"],"sourcesContent":["import { publicAssetsURL } from '#internal/nuxt/paths';export default publicAssetsURL(\"/logo/earth-man920.png\")","// composables/useCart.ts\ninterface CartItem {\n  product: string\n  product_slug?: string\n  product_variant_slug?: string\n  avatar_image: string\n  size?: string\n  product_size?: string\n  quantity: number\n  unit_price_original: string\n  unit_price_discounted: string\n}\n\ninterface CartData {\n  items: CartItem[]\n  cart_total_original_price: string\n  cart_total_discounted_price: string\n  cart_total_to_pay: string\n}\n\ninterface CartState {\n  data: CartData\n  loading: boolean\n  error: Error | null\n}\n\nlet abortController: AbortController | null = null\n\nexport function useCart() {\n  // Move useState INSIDE the composable function\n  const cartState = useState<CartState>('cart', () => ({\n    data: {\n      items: [],\n      cart_total_original_price: '0.00',\n      cart_total_discounted_price: '0.00',\n      cart_total_to_pay: '0.00'\n    },\n    loading: false,\n    error: null\n  }))\n\n  const items = computed(() => \n    cartState.value.data.items.map((item) => ({\n      ...item,\n      size: item.size ?? item.product_size\n    }))\n  )\n\n  const itemCount = computed(() => items.value.length)\n\n  const totals = computed(() => ({\n    original: cartState.value.data.cart_total_original_price,\n    discounted: cartState.value.data.cart_total_discounted_price,\n    toPay: cartState.value.data.cart_total_to_pay\n  }))\n\n  async function fetchCart(): Promise<void> {\n    if (abortController) {\n      abortController.abort()\n    }\n    \n    abortController = new AbortController()\n    cartState.value.loading = true\n    cartState.value.error = null\n\n    try {\n      const response = await $fetch<CartData>('/api/private/get/cart', {\n        signal: abortController.signal\n      })\n      \n      cartState.value.data = response\n    } catch (error) {\n      if (error instanceof Error && error.name !== 'AbortError') {\n        cartState.value.error = error\n        console.warn('Cart fetch failed:', error)\n      }\n    } finally {\n      cartState.value.loading = false\n      abortController = null\n    }\n  }\n\n  async function removeItem(item: CartItem): Promise<boolean> {\n    const slug = item.product_variant_slug ?? item.product_slug\n    if (!slug) return false\n\n    const previousData = { ...cartState.value.data }\n    \n    // Optimistic update\n    cartState.value.data = {\n      ...cartState.value.data,\n      items: cartState.value.data.items.filter(\n        (x) => (x.product_variant_slug ?? x.product_slug) !== slug\n      )\n    }\n\n    try {\n      await $fetch('/api/private/delete/cart', {\n        method: 'DELETE',\n        headers: { 'Content-Type': 'application/json' },\n        body: { product_variant_slug: slug }\n      })\n\n      await fetchCart()\n\n      if (import.meta.client) {\n        window.dispatchEvent(\n          new CustomEvent('cart:updated', {\n            detail: { source: 'cart', removed: slug }\n          })\n        )\n      }\n\n      return true\n    } catch (error) {\n      cartState.value.data = previousData\n      console.error('Remove item failed:', error)\n      return false\n    }\n  }\n\n  function toNumber(value: unknown): number {\n    const num = Number.parseFloat(String(value ?? '0').replace(',', '.'))\n    return Number.isFinite(num) ? num : 0\n  }\n\n  function formatMoney(amount: number): string {\n    return Number.isInteger(amount) ? amount.toString() : amount.toFixed(2)\n  }\n\n  const FREE_THRESHOLD = 200\n  const FLAT_SHIPPING = 12.99\n\n  const merchandiseTotal = computed(() => toNumber(totals.value.toPay))\n\n  const shippingFee = computed(() => \n    merchandiseTotal.value >= FREE_THRESHOLD ? 0 : FLAT_SHIPPING\n  )\n\n  const grandTotal = computed(() => merchandiseTotal.value + shippingFee.value)\n\n  const shippingLabel = computed(() => \n    shippingFee.value === 0 ? 'Free shipping' : 'Shipping'\n  )\n\n  const freeShippingHint = computed(() => {\n    if (shippingFee.value === 0) {\n      return 'Free shipping applied'\n    }\n    const remaining = Math.max(0, FREE_THRESHOLD - merchandiseTotal.value)\n    return `You're â‚¬${formatMoney(remaining)} away from free shipping`\n  })\n\n  return {\n    // State\n    items,\n    itemCount,\n    totals,\n    loading: computed(() => cartState.value.loading),\n    error: computed(() => cartState.value.error),\n    \n    // Actions\n    fetchCart,\n    removeItem,\n    \n    // Computed values\n    merchandiseTotal,\n    shippingFee,\n    grandTotal,\n    shippingLabel,\n    freeShippingHint,\n    \n    // Utilities\n    formatMoney,\n    toNumber\n  }\n}","<template>\n  <section>\n    <!-- Desktop Navigation -->\n    <div class=\"hidden md:flex flex-col lg:flex-row w-full z-50\">\n      <!-- Logo Section -->\n      <div class=\"flex flex-col w-full lg:w-1/2 h-full\">          \n        <div class=\"absolute inset-x-0 top-0 w-1/2 h-full md:px-8\">\n          <NuxtLink\n            to=\"/\"\n            class=\"flex justify-center py-6\"\n          >\n            <img \n              src=\"/logo/earth-man920.png\" \n              alt=\"Earth Man Logo\" \n              class=\"max-w-[100%] h-auto object-contain\" \n            />\n          </NuxtLink>\n        </div>\n      </div>\n\n      <!-- Navigation Links Section -->\n      <div class=\"hidden md:flex w-full items-start justify-end lg:w-1/2 px-4 md:px-8 md:py-14 lg:py-24 gap-6 h-full\">\n        <section class=\"flex flex-col justify-end w-full bg-transparent z-50 my-auto\">\n          <div class=\"flex pt-4\">\n            <div class=\"flex flex-row justify-end w-full mx-auto space-x-4 py-4\">\n              <NuxtLink\n                to=\"/shop\"\n                :class=\"[linkColorClass, getNavWeight('/shop'), 'text-sm my-auto px-4']\"\n              >\n                SHOP\n              </NuxtLink>\n\n              <NuxtLink\n                to=\"/collections\"\n                :class=\"[linkColorClass, getNavWeight('/collections'), 'text-sm my-auto px-4']\"\n              >\n                STORIES\n              </NuxtLink>\n\n              <NuxtLink\n                to=\"/about\"\n                :class=\"[linkColorClass, getNavWeight('/about'), 'text-sm my-auto px-4']\"\n              >\n                ABOUT\n              </NuxtLink>\n\n              <!-- Cart Icon -->\n              <ClientOnly>\n                <button\n                  type=\"button\"\n                  class=\"relative my-auto px-4 cursor-pointer\"\n                  :class=\"[linkColorClass, getNavWeight('/cart')]\"\n                  @click=\"openCart\"\n                  aria-label=\"Open shopping cart\"\n                >\n                  <Icon name=\"lucide:shopping-cart\" class=\"w-6 h-6\" :class=\"linkColorClass\" />\n                  <span\n                    v-if=\"itemCount > 0\"\n                    class=\"absolute -top-1 -right-1 bg-text_color text-background_color text-[12px] w-4 h-4 flex items-center justify-center\"\n                    aria-label=\"{itemCount} items in cart\"\n                  >\n                    {{ itemCount }}\n                  </span>\n                </button>\n              </ClientOnly>\n\n              <!-- User Profile Icon -->\n              <NuxtLink\n                to=\"/profile\"\n                :class=\"[linkColorClass, getNavWeight('/profile'), 'my-auto font-light pl-4']\"\n                aria-label=\"User profile\"\n              >\n                <Icon name=\"lucide:circle-user-round\" class=\"w-6 h-6\" :class=\"linkColorClass\" />\n              </NuxtLink>\n            </div>\n\n            <ClientOnly>\n              <CartPanel v-model:open=\"cartOpen\" />\n              <MobileMenu v-model:open=\"mobileMenuOpen\" />\n            </ClientOnly>\n          </div>\n        </section>\n      </div>\n    </div>\n\n    <!-- Mobile Navigation -->\n    <section class=\"flex md:hidden flex-col md:flex-row items-start md:items-center justify-between px-4 md:px-8 py-6 gap-6\">\n      <div class=\"flex md:hidden items-center justify-between w-full px-2\">\n        <!-- Mobile Logo -->\n        <div class=\"w-[60%] max-w-[200px]\">\n          <NuxtLink to=\"/\" class=\"block\">\n            <img \n              src=\"/logo/earth-man920.png\" \n              alt=\"Earth Man Logo\" \n              class=\"w-full h-auto max-h-12 object-contain object-left\"\n            />\n          </NuxtLink>\n        </div>\n\n        <!-- Mobile Icons -->\n        <div class=\"flex items-center gap-4\">\n          <!-- Cart Icon -->\n          <ClientOnly>\n            <button\n              type=\"button\"\n              class=\"relative cursor-pointer\"\n              :class=\"linkColorClass\"\n              @click=\"openCart\"\n              aria-label=\"Open shopping cart\"\n            >\n              <Icon name=\"lucide:shopping-cart\" class=\"w-6 h-6\" :class=\"linkColorClass\" />\n              <span\n                v-if=\"itemCount > 0\"\n                class=\"absolute -top-1 -right-1 bg-text_color text-background_color text-[10px] w-[14px] h-[14px] md:text-[12px] md:w-4 md:h-4 flex items-center justify-center\"\n                aria-label=\"{itemCount} items in cart\"\n              >\n                {{ itemCount }}\n              </span>\n            </button>\n          </ClientOnly>\n\n          <!-- Hamburger Menu -->\n          <button \n            type=\"button\"\n            @click=\"openMobileMenu\"\n            aria-label=\"Open menu\"\n          >\n            <Icon name=\"lucide:menu\" class=\"w-7 h-7\" :class=\"linkColorClass\" />\n          </button>\n        </div>\n      </div>\n    </section>\n  </section>\n</template>\n\n<script setup lang=\"ts\">\ninterface Props {\n  dark?: boolean\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  dark: false\n})\n\nconst route = useRoute()\nconst { itemCount, fetchCart } = useCart()\n\nconst cartOpen = ref(false)\nconst mobileMenuOpen = ref(false)\n\nconst linkColorClass = computed(() =>\n  props.dark ? 'text-background_color' : 'text-text_color'\n)\n\nfunction isPathActive(path: string): boolean {\n  return route.path === path || route.path.startsWith(`${path}/`)\n}\n\nfunction getNavWeight(path: string): string {\n  return isPathActive(path) ? 'font-bold' : 'font-light'\n}\n\nfunction openCart(): void {\n  cartOpen.value = true\n}\n\nfunction openMobileMenu(): void {\n  mobileMenuOpen.value = true\n}\n\nfunction handleCartUpdate(): void {\n  fetchCart()\n}\n\nonMounted(() => {\n  fetchCart()\n  \n  if (import.meta.client) {\n    window.addEventListener('cart:updated', handleCartUpdate)\n  }\n})\n\nonBeforeUnmount(() => {\n  if (import.meta.client) {\n    window.removeEventListener('cart:updated', handleCartUpdate)\n  }\n})\n</script>\n\n<style scoped>\n/* Fallback for browsers that don't support object-contain */\n@supports not (object-fit: contain) {\n  img {\n    max-width: 100%;\n    height: auto;\n  }\n}\n</style>"],"names":["_push","_parent","_ssrRenderAttr","_createVNode","_unref"],"mappings":"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"}