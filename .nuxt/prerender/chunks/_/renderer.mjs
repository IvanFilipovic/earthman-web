import{createRenderer as e,getRequestDependencies as t,getPreloadLinks as r,getPrefetchLinks as o}from"file:///home/kai/Projekti/webshop/node_modules/vue-bundle-renderer/dist/runtime.mjs";import{getResponseStatusText as n,getResponseStatus as s,getQuery as a,createError as i,appendResponseHeader as d}from"file:///home/kai/Projekti/webshop/node_modules/h3/dist/index.mjs";import{b as l,a as u,c as p,u as c,d as h,e as m,f,p as y,g as b,h as g,i as w,j as _,k as j,w as x,l as v,m as k}from"../nitro/nitro.mjs";import{renderToString as C}from"file:///home/kai/Projekti/webshop/node_modules/vue/server-renderer/index.mjs";import{createHead as S,propsToString as P,renderSSRHead as R}from"file:///home/kai/Projekti/webshop/node_modules/unhead/dist/server.mjs";import{stringify as T,uneval as A}from"file:///home/kai/Projekti/webshop/node_modules/devalue/index.js";import{walkResolver as $}from"file:///home/kai/Projekti/webshop/node_modules/unhead/dist/utils.mjs";import{toValue as H,isRef as L,hasInjectionContext as U,inject as O,ref as M,watchEffect as z,getCurrentInstance as I,onBeforeUnmount as N,onDeactivated as E,onActivated as F}from"file:///home/kai/Projekti/webshop/node_modules/vue/index.mjs";import{DeprecationsPlugin as D,PromisesPlugin as J,TemplateParamsPlugin as X,AliasSortingPlugin as q}from"file:///home/kai/Projekti/webshop/node_modules/unhead/dist/plugins.mjs";import{relative as B}from"file:///home/kai/Projekti/webshop/node_modules/pathe/dist/index.mjs";const VueResolver=(e,t)=>L(t)?H(t):t,K="usehead";function useHead(e,t={}){const r=t.head||function(){if(U()){const e=O(K);if(!e)throw new Error("useHead() was called without provide context, ensure you call it through the setup() function.");return e}throw new Error("useHead() was called without provide context, ensure you call it through the setup() function.")}();return r.ssr?r.push(e||{},t):function(e,t,r={}){const o=M(!1);let n;z(()=>{const s=o.value?{}:$(t,VueResolver);n?n.patch(s):n=e.push(s,r)});I()&&(N(()=>{n.dispose()}),E(()=>{o.value=!0}),F(()=>{o.value=!1}));return n}(r,e,t)}function createHead(e={}){const t=S({...e,propResolvers:[VueResolver]});return t.install=function(e){return{install(t){t.config.globalProperties.$unhead=e,t.config.globalProperties.$head=e,t.provide(K,e)}}.install}(t),t}const W=`<${u}${P(p)}>`,Y=`</${u}>`,getClientManifest=()=>import("../build/client.manifest.mjs").then(e=>e.default||e).then(e=>"function"==typeof e?e():e),G=lazyCachedFunction(async()=>{const t=await getClientManifest();if(!t)throw new Error("client.manifest is not available");const r=await import("../build/server.mjs").then(e=>e.default||e);if(!r)throw new Error("Server bundle is not available");return e(r,{manifest:t,renderToString:async function(e,t){const r=await C(e,t);return W+r+Y},buildAssetsURL:l})}),Q=lazyCachedFunction(async()=>{const t=await getClientManifest(),r=await import("../virtual/_virtual_spa-template.mjs").then(e=>e.template).catch(()=>"").then(e=>W+e+Y),o=e(()=>()=>{},{manifest:t,renderToString:()=>r,buildAssetsURL:l}),n=await o.renderToString({});return{rendererContext:o.rendererContext,renderToString:e=>{const t=c(e.event);return e.modules||=new Set,e.payload.serverRendered=!1,e.config={public:t.public,app:t.app},Promise.resolve(n)}}});function lazyCachedFunction(e){let t=null;return()=>(null===t&&(t=e().catch(e=>{throw t=null,e})),t)}const V=lazyCachedFunction(()=>import("../build/styles.mjs").then(e=>e.default||e)),Z=h("internal:nuxt:prerender:payload");function renderPayloadResponse(e){return{body:T(splitPayload(e).payload,e._payloadReducers),statusCode:s(e.event),statusMessage:n(e.event),headers:{"content-type":"application/json;charset=utf-8","x-powered-by":"Nuxt"}}}function renderPayloadJsonScript(e){const t={type:"application/json",innerHTML:e.data?T(e.data,e.ssrContext._payloadReducers):"","data-nuxt-data":m,"data-ssr":!e.ssrContext.noSSR,id:"__NUXT_DATA__"};e.src&&(t["data-src"]=e.src);return[t,{innerHTML:`window.__NUXT__={};window.__NUXT__.config=${A(e.ssrContext.config)}`}]}function splitPayload(e){const{data:t,prerenderedAt:r,...o}=e.payload;return{initial:{...o,prerenderedAt:r},payload:{data:t,prerenderedAt:r}}}h("internal:nuxt:prerender:island"),h("internal:nuxt:prerender:island-props");const ee={disableDefaults:!0,disableCapoSorting:!1,plugins:[D,J,X,q]},te=new Set(["/index.html","/200.html","/404.html"]);const re={omitLineBreaks:!1};globalThis.__buildAssetsURL=l,globalThis.__publicAssetsURL=y;const oe=!!g.id,ne=oe?`<${b}${P(g)}>`:"",se=oe?`</${b}>`:"",ae=/^[^?]*\/_payload.json(?:\?.*)?$/,ie="_payload.json";let de;const le=f(async e=>{const u=k(),p=e.path.startsWith("/__nuxt_error")?a(e):null;if(p&&!("__unenv__"in e.node.req))throw i({statusCode:404,statusMessage:"Page Not Found: /__nuxt_error"});const h=function(e){const t={url:e.path,event:e,runtimeConfig:c(e),noSSR:e.context.nuxt?.noSSR||te.has(e.path),head:createHead(ee),error:!1,nuxt:void 0,payload:{},_payloadReducers:Object.create(null),modules:new Set};return t.payload.prerenderedAt=Date.now(),t}(e),m={mode:"server"};h.head.push(w,m),p&&(p.statusCode&&=Number.parseInt(p.statusCode),function(e,t){e.error=!0,e.payload={error:t},e.url=t.url}(h,p));const f=ae.test(h.url);if(f){const t=h.url.substring(0,h.url.lastIndexOf("/"))||"/";if(h.url=t,e._path=e.node.req.url=t,await Z.hasItem(t))return Z.getItem(t)}const y=_(e);!1===y.ssr&&(h.noSSR=!0);const b=!h.noSSR,C=b?j(h.runtimeConfig.app.cdnURL||h.runtimeConfig.app.baseURL,h.url.replace(/\?.*$/,""),ie)+"?"+h.runtimeConfig.app.buildId:void 0,S=await function(e){return e.noSSR?Q():G()}(h);for(const e of await getClientManifest().then(e=>{const t=[];for(const r of Object.values(e))r._globalCSS&&t.push(r.src);return t}))h.modules.add(e);const P=await S.renderToString(h).catch(async e=>{if(h._renderResponse&&"skipping render"===e.message)return{};const t=!p&&h.payload?.error||e;throw await(h.nuxt?.hooks.callHook("app:error",t)),t}),T=h._renderResponse||f?[]:await async function(e){const t=await V(),r=new Set;for(const o of e)if(o in t&&t[o])for(const e of await t[o]())r.add(e);return Array.from(r).map(e=>({innerHTML:e}))}(h.modules??[]);if(await(h.nuxt?.hooks.callHook("app:rendered",{ssrContext:h,renderResult:P})),h._renderResponse)return h._renderResponse;if(h.payload?.error&&!p)throw h.payload.error;if(f){const e=renderPayloadResponse(h);return await Z.setItem(h.url,e),e}b&&(d(e,"x-nitro-prerender",j(h.url.replace(/\?.*$/,""),ie)),await Z.setItem(x(h.url),renderPayloadResponse(h)));const A=y.noScripts,{styles:$,scripts:H}=t(h,S.rendererContext);if(!A){let t=de;t||(t=l("r-_Kuc5h.js"),/^(?:\/|\.+\/)/.test(t)||v(t,{acceptRelative:!0})?de=t:(t=B(e.path.replace(/\/[^/]+$/,"/"),j("/",t)),/^(?:\/|\.+\/)/.test(t)||(t=`./${t}`))),h.head.push({script:[{tagPosition:"head",tagPriority:-2,type:"importmap",innerHTML:JSON.stringify({imports:{"#entry":t}})}]},m)}b&&!A&&h.head.push({link:[{rel:"preload",as:"fetch",crossorigin:"anonymous",href:C}]},m),h._preloadManifest&&!A&&h.head.push({link:[{rel:"preload",as:"fetch",fetchpriority:"low",crossorigin:"anonymous",href:l(`builds/meta/${h.runtimeConfig.app.buildId}.json`)}]},{...m,tagPriority:"low"}),T.length&&h.head.push({style:T});const L=[];for(const e of Object.values($))L.push({rel:"stylesheet",href:S.rendererContext.buildAssetsURL(e.file),crossorigin:""});if(L.length&&h.head.push({link:L},m),A||(h.head.push({link:r(h,S.rendererContext)},m),h.head.push({link:o(h,S.rendererContext)},m),h.head.push({script:renderPayloadJsonScript(b?{ssrContext:h,data:splitPayload(h).initial,src:C}:{ssrContext:h,data:h.payload})},{...m,tagPosition:"bodyClose",tagPriority:"high"})),!y.noScripts){const e="head";h.head.push({script:Object.values(H).map(t=>({type:t.module?"module":null,src:S.rendererContext.buildAssetsURL(t.file),defer:!t.module||null,tagPosition:e,crossorigin:""}))},m)}const{headTags:U,bodyTags:O,bodyTagsOpen:M,htmlAttrs:z,bodyAttrs:I}=await R(h.head,re),N={htmlAttrs:z?[z]:[],head:normalizeChunks([U]),bodyAttrs:I?[I]:[],bodyPrepend:normalizeChunks([M,h.teleports?.body]),body:[P.html,ne+(oe?joinTags([h.teleports?.[`#${g.id}`]]):"")+se],bodyAppend:[O]};return await u.hooks.callHook("render:html",N,{event:e}),{body:(E=N,`<!DOCTYPE html><html${joinAttrs(E.htmlAttrs)}><head>${joinTags(E.head)}</head><body${joinAttrs(E.bodyAttrs)}>${joinTags(E.bodyPrepend)}${joinTags(E.body)}${joinTags(E.bodyAppend)}</body></html>`),statusCode:s(e),statusMessage:n(e),headers:{"content-type":"text/html;charset=utf-8","x-powered-by":"Nuxt"}};var E});function normalizeChunks(e){const t=[];for(const r of e){const e=r?.trim();e&&t.push(e)}return t}function joinTags(e){return e.join("")}function joinAttrs(e){return 0===e.length?"":" "+e.join(" ")}const ue=Object.freeze(Object.defineProperty({__proto__:null,default:le},Symbol.toStringTag,{value:"Module"}));export{K as h,ue as r,useHead as u};
//# sourceMappingURL=renderer.mjs.map
