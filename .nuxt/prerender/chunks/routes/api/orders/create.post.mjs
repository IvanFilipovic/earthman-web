import{defineEventHandler as e,readBody as o,createError as i,getHeader as t}from"file:///home/kai/Projekti/webshop/node_modules/h3/dist/index.mjs";import{a as s,e as r}from"../../../nitro/nitro.mjs";import"file:///home/kai/Projekti/webshop/node_modules/nodemailer/lib/nodemailer.js";import"node:crypto";import"file:///home/kai/Projekti/webshop/node_modules/destr/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/hookable/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/ofetch/dist/node.mjs";import"file:///home/kai/Projekti/webshop/node_modules/node-mock-http/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/unstorage/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/unstorage/drivers/fs.mjs";import"file:///home/kai/Projekti/webshop/node_modules/unstorage/drivers/fs-lite.mjs";import"file:///home/kai/Projekti/webshop/node_modules/unstorage/drivers/lru-cache.mjs";import"file:///home/kai/Projekti/webshop/node_modules/ohash/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/klona/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/defu/dist/defu.mjs";import"file:///home/kai/Projekti/webshop/node_modules/scule/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/unctx/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/radix3/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/@intlify/utils/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/cookie-es/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/vue-router/dist/vue-router.node.mjs";import"node:fs";import"node:url";import"file:///home/kai/Projekti/webshop/node_modules/pathe/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/@iconify/utils/lib/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/consola/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/ipx/dist/index.mjs";const d=e(async e=>{var d;const m=s(),a=await o(e),n=["email","country","address","city","postal_code","phone_number","delivery_address","delivery_city","delivery_postal_code","payment_method","shipping_cost"];for(const e of n)if(!a[e])throw i({statusCode:400,message:`Missing required field: ${e}`});if(!["card","paypal"].includes(a.payment_method))throw i({statusCode:400,message:'Invalid payment method. Must be "card" or "paypal"'});if("number"!=typeof a.shipping_cost||a.shipping_cost<0)throw i({statusCode:400,message:"Invalid shipping cost"});const p={email:a.email.trim().toLowerCase(),country:a.country.trim(),address:a.address.trim(),city:a.city.trim(),postal_code:a.postal_code.trim(),phone_number:a.phone_number.trim(),delivery_address:a.delivery_address.trim(),delivery_city:a.delivery_city.trim(),delivery_postal_code:a.delivery_postal_code.trim(),payment_method:a.payment_method,shipping_cost:a.shipping_cost,session_id:a.session_id};try{const o=t(e,"cookie"),i=await $fetch(`${m.apiBase}/api/orders/create/`,{method:"POST",headers:{"Content-Type":"application/json",...o&&{Cookie:o}},body:p});return{payment_id:r({clientSecret:i.client_secret,paypalApprovalUrl:i.paypal_approval_url,orderReference:i.order_reference,amount:parseFloat(i.total_price),currency:"EUR",paymentMethod:i.payment_method,expiresAt:Date.now()+36e5}),order_reference:i.order_reference,total_price:i.total_price,payment_method:i.payment_method}}catch(e){throw console.error("Order creation failed:",e),i({statusCode:e.statusCode||500,message:(null==(d=e.data)?void 0:d.detail)||"Failed to create order"})}});export{d as default};
//# sourceMappingURL=create.post.mjs.map
