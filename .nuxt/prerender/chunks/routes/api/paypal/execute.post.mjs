import{defineEventHandler as e,readBody as o,createError as i}from"file:///home/kai/Projekti/webshop/node_modules/h3/dist/index.mjs";import{a as s,d as t}from"../../../nitro/nitro.mjs";import"file:///home/kai/Projekti/webshop/node_modules/nodemailer/lib/nodemailer.js";import"node:crypto";import"file:///home/kai/Projekti/webshop/node_modules/destr/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/hookable/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/ofetch/dist/node.mjs";import"file:///home/kai/Projekti/webshop/node_modules/node-mock-http/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/unstorage/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/unstorage/drivers/fs.mjs";import"file:///home/kai/Projekti/webshop/node_modules/unstorage/drivers/fs-lite.mjs";import"file:///home/kai/Projekti/webshop/node_modules/unstorage/drivers/lru-cache.mjs";import"file:///home/kai/Projekti/webshop/node_modules/ohash/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/klona/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/defu/dist/defu.mjs";import"file:///home/kai/Projekti/webshop/node_modules/scule/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/unctx/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/radix3/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/@intlify/utils/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/cookie-es/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/vue-router/dist/vue-router.node.mjs";import"node:fs";import"node:url";import"file:///home/kai/Projekti/webshop/node_modules/pathe/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/@iconify/utils/lib/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/consola/dist/index.mjs";import"file:///home/kai/Projekti/webshop/node_modules/ipx/dist/index.mjs";const r=e(async e=>{var r;const d=s(),m=await o(e);if(!m.payment_id||!m.payer_id||!m.order_reference)throw i({statusCode:400,message:"Payment ID, Payer ID, and order reference are required"});if(!/^[A-Z0-9-]+$/.test(m.order_reference))throw i({statusCode:400,message:"Invalid order reference format"});if(m.payment_session_id)try{const e=t(m.payment_session_id);if(e.orderReference!==m.order_reference)throw i({statusCode:400,message:"Order reference mismatch"});if("paypal"!==e.paymentMethod)throw i({statusCode:400,message:"Invalid payment method for this endpoint"})}catch(e){console.warn("Payment token validation failed, proceeding with server verification")}try{return await $fetch(`${d.apiBase}/api/paypal/execute/`,{method:"POST",headers:{"Content-Type":"application/json"},body:{payment_id:m.payment_id,payer_id:m.payer_id,order_reference:m.order_reference}})}catch(e){throw console.error("PayPal execution failed:",e),i({statusCode:e.statusCode||500,message:(null==(r=e.data)?void 0:r.detail)||"PayPal payment execution failed"})}});export{r as default};
//# sourceMappingURL=execute.post.mjs.map
