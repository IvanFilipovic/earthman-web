import{d as e,r as t,c as o,g as r,a as i,e as a}from"../../../nitro/nitro.mjs";import"nodemailer";import"crypto";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@intlify/utils";import"vue-router";import"@iconify/utils";import"consola";import"node:url";import"ipx";const s=e(async e=>{var s;const d=i(),p=await t(e),n=["email","country","address","city","postal_code","phone_number","delivery_address","delivery_city","delivery_postal_code","payment_method","shipping_cost"];for(const e of n)if(!p[e])throw o({statusCode:400,message:`Missing required field: ${e}`});if(!["card","paypal"].includes(p.payment_method))throw o({statusCode:400,message:'Invalid payment method. Must be "card" or "paypal"'});if("number"!=typeof p.shipping_cost||p.shipping_cost<0)throw o({statusCode:400,message:"Invalid shipping cost"});const m={email:p.email.trim().toLowerCase(),country:p.country.trim(),address:p.address.trim(),city:p.city.trim(),postal_code:p.postal_code.trim(),phone_number:p.phone_number.trim(),delivery_address:p.delivery_address.trim(),delivery_city:p.delivery_city.trim(),delivery_postal_code:p.delivery_postal_code.trim(),payment_method:p.payment_method,shipping_cost:p.shipping_cost,session_id:p.session_id};try{const t=r(e,"cookie"),o=await $fetch(`${d.apiBase}/api/orders/create/`,{method:"POST",headers:{"Content-Type":"application/json",...t&&{Cookie:t}},body:m});return{payment_id:a({clientSecret:o.client_secret,paypalApprovalUrl:o.paypal_approval_url,orderReference:o.order_reference,amount:parseFloat(o.total_price),currency:"EUR",paymentMethod:o.payment_method,expiresAt:Date.now()+36e5}),order_reference:o.order_reference,total_price:o.total_price,payment_method:o.payment_method}}catch(e){throw console.error("Order creation failed:",e),o({statusCode:e.statusCode||500,message:(null==(s=e.data)?void 0:s.detail)||"Failed to create order"})}});export{s as default};
//# sourceMappingURL=create.post.mjs.map
