import{d as e,r as t,c as r,b as o,a as i}from"../../../nitro/nitro.mjs";import"nodemailer";import"crypto";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@intlify/utils";import"vue-router";import"@iconify/utils";import"consola";import"node:url";import"ipx";const n=e(async e=>{var n;const a=i(),d=await t(e);if(!d.payment_intent_id||!d.order_reference)throw r({statusCode:400,message:"Payment intent ID and order reference are required"});if(d.payment_id)try{if(o(d.payment_id).orderReference!==d.order_reference)throw r({statusCode:400,message:"Order reference mismatch"})}catch(e){console.warn("Payment token validation failed, proceeding with server verification")}try{return await $fetch(`${a.apiBase}/api/stripe/verify-payment/`,{method:"POST",headers:{"Content-Type":"application/json"},body:{payment_intent_id:d.payment_intent_id,order_reference:d.order_reference}})}catch(e){throw console.error("Payment verification failed:",e),r({statusCode:e.statusCode||500,message:(null==(n=e.data)?void 0:n.detail)||"Payment verification failed"})}});export{n as default};
//# sourceMappingURL=verify.post.mjs.map
