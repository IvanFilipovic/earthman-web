import{d as e,r,c as t,b as o,a}from"../../../nitro/nitro.mjs";import"nodemailer";import"crypto";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@intlify/utils";import"vue-router";import"@iconify/utils";import"consola";import"node:url";import"ipx";const i=e(async e=>{var i;const n=a(),s=await r(e);if(!s.payment_id||!s.payer_id||!s.order_reference)throw t({statusCode:400,message:"Payment ID, Payer ID, and order reference are required"});if(!/^[A-Z0-9-]+$/.test(s.order_reference))throw t({statusCode:400,message:"Invalid order reference format"});if(s.payment_session_id)try{const e=o(s.payment_session_id);if(e.orderReference!==s.order_reference)throw t({statusCode:400,message:"Order reference mismatch"});if("paypal"!==e.paymentMethod)throw t({statusCode:400,message:"Invalid payment method for this endpoint"})}catch(e){console.warn("Payment token validation failed, proceeding with server verification")}try{return await $fetch(`${n.apiBase}/api/paypal/execute/`,{method:"POST",headers:{"Content-Type":"application/json"},body:{payment_id:s.payment_id,payer_id:s.payer_id,order_reference:s.order_reference}})}catch(e){throw console.error("PayPal execution failed:",e),t({statusCode:e.statusCode||500,message:(null==(i=e.data)?void 0:i.detail)||"PayPal payment execution failed"})}});export{i as default};
//# sourceMappingURL=execute.post.mjs.map
