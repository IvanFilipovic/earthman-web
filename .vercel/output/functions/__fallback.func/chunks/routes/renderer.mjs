import{createRenderer as e,getRequestDependencies as t,getPreloadLinks as r,getPrefetchLinks as n}from"vue-bundle-renderer/runtime";import{e as o,f as s,h as a,a as i,i as d,j as l,k as u,l as c,p,m as h,n as f,b as m,c as y,o as g,q as b,s as _,t as w,v,w as j}from"../nitro/nitro.mjs";import{renderToString as C}from"vue/server-renderer";import{createHead as S,propsToString as x,renderSSRHead as T}from"unhead/server";import{stringify as A,uneval as R}from"devalue";import{FlatMetaPlugin as $,DeprecationsPlugin as H,PromisesPlugin as P,TemplateParamsPlugin as k,AliasSortingPlugin as M}from"unhead/plugins";import{walkResolver as L}from"unhead/utils";import{toValue as O,isRef as U,hasInjectionContext as z,inject as N,ref as E,watchEffect as F,getCurrentInstance as q,onBeforeUnmount as D,onDeactivated as I,onActivated as J}from"vue";const VueResolver=(e,t)=>U(t)?O(t):t,X="usehead";function injectHead(){if(z()){const e=N(X);if(!e)throw new Error("useHead() was called without provide context, ensure you call it through the setup() function.");return e}throw new Error("useHead() was called without provide context, ensure you call it through the setup() function.")}function useHead(e,t={}){const r=t.head||injectHead();return r.ssr?r.push(e||{},t):function(e,t,r={}){const n=E(!1);let o;F(()=>{const s=n.value?{}:L(t,VueResolver);o?o.patch(s):o=e.push(s,r)});q()&&(D(()=>{o.dispose()}),I(()=>{n.value=!0}),J(()=>{n.value=!1}));return o}(r,e,t)}function useSeoMeta(e={},t={}){(t.head||injectHead()).use($);const{title:r,titleTemplate:n,...o}=e;return useHead({title:r,titleTemplate:n,_flatMeta:o},t)}function createHead(e={}){const t=S({...e,propResolvers:[VueResolver]});return t.install=function(e){return{install(t){t.config.globalProperties.$unhead=e,t.config.globalProperties.$head=e,t.provide(X,e)}}.install}(t),t}const Q=`<${s}${x(a)}>`,B=`</${s}>`,getClientManifest=()=>import("../build/client.manifest.mjs").then(e=>e.default||e).then(e=>"function"==typeof e?e():e),W=lazyCachedFunction(async()=>{const t=await getClientManifest();if(!t)throw new Error("client.manifest is not available");const r=await import("../build/server.mjs").then(e=>e.default||e);if(!r)throw new Error("Server bundle is not available");return e(r,{manifest:t,renderToString:async function(e,t){const r=await C(e,t);return Q+r+B},buildAssetsURL:o})}),Y=lazyCachedFunction(async()=>{const t=await getClientManifest(),r=await import("../virtual/_virtual_spa-template.mjs").then(e=>e.template).catch(()=>"").then(e=>Q+e+B),n=e(()=>()=>{},{manifest:t,renderToString:()=>r,buildAssetsURL:o}),s=await n.renderToString({});return{rendererContext:n.rendererContext,renderToString:e=>{const t=i(e.event);return e.modules||=new Set,e.payload.serverRendered=!1,e.config={public:t.public,app:t.app},Promise.resolve(s)}}});function lazyCachedFunction(e){let t=null;return()=>(null===t&&(t=e().catch(e=>{throw t=null,e})),t)}const Z=lazyCachedFunction(()=>import("../build/styles.mjs").then(e=>e.default||e));function renderPayloadJsonScript(e){const t={type:"application/json",innerHTML:e.data?A(e.data,e.ssrContext._payloadReducers):"","data-nuxt-data":u,"data-ssr":!e.ssrContext.noSSR,id:"__NUXT_DATA__"};e.src&&(t["data-src"]=e.src);return[t,{innerHTML:`window.__NUXT__={};window.__NUXT__.config=${R(e.ssrContext.config)}`}]}function splitPayload(e){const{data:t,prerenderedAt:r,...n}=e.payload;return{initial:{...n,prerenderedAt:r},payload:{data:t,prerenderedAt:r}}}const G={disableDefaults:!0,disableCapoSorting:!1,plugins:[H,P,k,M]};const K={omitLineBreaks:!1};globalThis.__buildAssetsURL=o,globalThis.__publicAssetsURL=p;const V=!!f.id,ee=V?`<${h}${x(f)}>`:"",te=V?`</${h}>`:"",re=/^[^?]*\/_payload.json(?:\?.*)?$/;let ne;const oe=c(async e=>{const s=j(),a=e.path.startsWith("/__nuxt_error")?m(e):null;if(a&&!("__unenv__"in e.node.req))throw y({statusCode:404,statusMessage:"Page Not Found: /__nuxt_error"});const u=function(e){return{url:e.path,event:e,runtimeConfig:i(e),noSSR:e.context.nuxt?.noSSR||!1,head:createHead(G),error:!1,nuxt:void 0,payload:{},_payloadReducers:Object.create(null),modules:new Set}}(e),c={mode:"server"};u.head.push(g,c),a&&(a.statusCode&&=Number.parseInt(a.statusCode),function(e,t){e.error=!0,e.payload={error:t},e.url=t.url}(u,a));const p=re.test(u.url);if(p){const t=u.url.substring(0,u.url.lastIndexOf("/"))||"/";u.url=t,e._path=e.node.req.url=t}const h=b(e);!1===h.ssr&&(u.noSSR=!0);const C=await function(e){return e.noSSR?Y():W()}(u);for(const e of await getClientManifest().then(e=>{const t=[];for(const r of Object.values(e))r._globalCSS&&t.push(r.src);return t}))u.modules.add(e);const S=await C.renderToString(u).catch(async e=>{if(u._renderResponse&&"skipping render"===e.message)return{};const t=!a&&u.payload?.error||e;throw await(u.nuxt?.hooks.callHook("app:error",t)),t}),x=u._renderResponse||p?[]:await async function(e){const t=await Z(),r=new Set;for(const n of e)if(n in t&&t[n])for(const e of await t[n]())r.add(e);return Array.from(r).map(e=>({innerHTML:e}))}(u.modules??[]);if(await(u.nuxt?.hooks.callHook("app:rendered",{ssrContext:u,renderResult:S})),u._renderResponse)return u._renderResponse;if(u.payload?.error&&!a)throw u.payload.error;if(p){const e=function(e){return{body:A(splitPayload(e).payload,e._payloadReducers),statusCode:l(e.event),statusMessage:d(e.event),headers:{"content-type":"application/json;charset=utf-8","x-powered-by":"Nuxt"}}}(u);return e}const R=h.noScripts,{styles:$,scripts:H}=t(u,C.rendererContext);if(!R){let t=ne;t||(t=o("CQOZtdQ6.js"),/^(?:\/|\.+\/)/.test(t)||_(t,{acceptRelative:!0})?ne=t:(t=w(e.path.replace(/\/[^/]+$/,"/"),v("/",t)),/^(?:\/|\.+\/)/.test(t)||(t=`./${t}`))),u.head.push({script:[{tagPosition:"head",tagPriority:-2,type:"importmap",innerHTML:JSON.stringify({imports:{"#entry":t}})}]},c)}u._preloadManifest&&!R&&u.head.push({link:[{rel:"preload",as:"fetch",fetchpriority:"low",crossorigin:"anonymous",href:o(`builds/meta/${u.runtimeConfig.app.buildId}.json`)}]},{...c,tagPriority:"low"}),x.length&&u.head.push({style:x});const P=[];for(const e of Object.values($))P.push({rel:"stylesheet",href:C.rendererContext.buildAssetsURL(e.file),crossorigin:""});if(P.length&&u.head.push({link:P},c),R||(u.head.push({link:r(u,C.rendererContext)},c),u.head.push({link:n(u,C.rendererContext)},c),u.head.push({script:renderPayloadJsonScript({ssrContext:u,data:u.payload})},{...c,tagPosition:"bodyClose",tagPriority:"high"})),!h.noScripts){const e="head";u.head.push({script:Object.values(H).map(t=>({type:t.module?"module":null,src:C.rendererContext.buildAssetsURL(t.file),defer:!t.module||null,tagPosition:e,crossorigin:""}))},c)}const{headTags:k,bodyTags:M,bodyTagsOpen:L,htmlAttrs:O,bodyAttrs:U}=await T(u.head,K),z={htmlAttrs:O?[O]:[],head:normalizeChunks([k]),bodyAttrs:U?[U]:[],bodyPrepend:normalizeChunks([L,u.teleports?.body]),body:[S.html,ee+(V?joinTags([u.teleports?.[`#${f.id}`]]):"")+te],bodyAppend:[M]};return await s.hooks.callHook("render:html",z,{event:e}),{body:(N=z,`<!DOCTYPE html><html${joinAttrs(N.htmlAttrs)}><head>${joinTags(N.head)}</head><body${joinAttrs(N.bodyAttrs)}>${joinTags(N.bodyPrepend)}${joinTags(N.body)}${joinTags(N.bodyAppend)}</body></html>`),statusCode:l(e),statusMessage:d(e),headers:{"content-type":"text/html;charset=utf-8","x-powered-by":"Nuxt"}};var N});function normalizeChunks(e){const t=[];for(const r of e){const e=r?.trim();e&&t.push(e)}return t}function joinTags(e){return e.join("")}function joinAttrs(e){return 0===e.length?"":" "+e.join(" ")}const se=Object.freeze(Object.defineProperty({__proto__:null,default:oe},Symbol.toStringTag,{value:"Module"}));export{useHead as a,X as h,se as r,useSeoMeta as u};
//# sourceMappingURL=renderer.mjs.map
