import{d as D,e as E,f as L,n as B}from"#entry";import{_ as T}from"./CiYSQXAz.js";import{C as V,k as g,b as x,D as N,F as d,N as R,a3 as t,ae as I,a4 as u,J as a,a7 as w,a9 as h,aa as P,a8 as M,X as m}from"./Cvp-EZ-T.js";import"./wm0FsEjJ.js";import"./C1jAaNN0.js";import"./DHhpbDuF.js";const j={class:"min-h-screen bg-background_color"},q={class:"max-w-2xl mx-auto px-4 py-12"},A={class:"mb-8"},F={class:"text-sm text-text_color/70"},O={class:"flex justify-between items-center mb-8 pb-6 border-b border-text_color/30"},$={class:"text-3xl font-semibold text-text_color"},H={key:0,class:"flex flex-col items-center justify-center py-20"},J={id:"payment-element",class:"mb-6"},K=["disabled"],U={key:0,class:"flex items-center justify-center gap-2"},W={key:1,class:"btn__text"},X={key:1,id:"payment-message",class:"mt-4 p-4 bg-error_text_color/10 border border-error_text_color rounded"},G={class:"flex items-start gap-2"},Q={class:"text-sm text-error_text_color"},ne=V({__name:"card",setup(Y){const v=D(),f=g(()=>v.query.payment_id),_=g(()=>v.query.ref),n=x(!1),r=x(""),l=x(!0);let i=null,p=null,b="",y=0,k="EUR";async function S(){if(!f.value||!_.value){r.value="Invalid payment session",l.value=!1;return}if(!(typeof window>"u"))try{const s=await $fetch("/api/payment/get-client-secret",{method:"POST",body:{payment_id:f.value}});b=s.client_secret,y=s.amount,k=s.currency;const{loadStripe:e}=await E(async()=>{const{loadStripe:z}=await import("./CuE7ILBx.js");return{loadStripe:z}},[],import.meta.url),o=L();if(i=await e(o.public.stripePublishableKey),!i)throw new Error("Failed to load Stripe");const c={theme:"stripe",variables:{colorPrimary:"#0040ff",colorBackground:"#e2e2e2",colorText:"#252525",colorDanger:"#C90D00",fontFamily:"system-ui, sans-serif",borderRadius:"4px"},rules:{".Input":{border:"1px solid rgba(37, 37, 37, 0.3)",padding:"12px",marginBottom:"8px"},".Label":{fontSize:"12px",fontWeight:"500",textTransform:"uppercase"}}};p=i.elements({clientSecret:b,appearance:c}),p.create("payment",{layout:"tabs"}).mount("#payment-element"),l.value=!1}catch(s){console.error("Error initializing payment:",s),r.value=s?.data?.message||"Failed to load payment form",l.value=!1}}async function C(s){if(s.preventDefault(),!i||!p){r.value="Payment system not ready";return}n.value=!0,r.value="";try{const{error:e,paymentIntent:o}=await i.confirmPayment({elements:p,redirect:"if_required",confirmParams:{return_url:`${window.location.origin}/payment/card/processing`}});if(e){r.value=e.message||"Payment failed",n.value=!1;return}if(o&&o.status==="succeeded"){const c=await $fetch("/api/payment/verify",{method:"POST",body:{payment_intent_id:o.id,order_reference:_.value,payment_id:f.value}});c.success?await B({path:"/thank-you",query:{ref:c.order_reference,total:c.total_price,payment_intent:"completed"}}):r.value="Payment verification failed. Please contact support."}else r.value="Payment was not completed successfully"}catch(e){r.value=e?.data?.message||"Payment failed. Please try again.",console.error("Payment error:",e)}finally{n.value=!1}}return N(()=>{S()}),(s,e)=>{const o=T;return m(),d("section",j,[R(o,{dark:!1}),t("div",q,[t("div",A,[e[0]||(e[0]=t("h1",{class:"text-2xl uppercase tracking-widest mb-2 text-text_color"},"Complete Payment",-1)),t("p",F,"Order: "+u(a(_)),1)]),t("form",{id:"payment-form",onSubmit:C,class:"border border-text_color/30 p-6 md:p-8 mb-6"},[t("div",O,[e[1]||(e[1]=t("span",{class:"text-sm uppercase tracking-widest text-text_color font-medium"},"Total Amount",-1)),t("span",$,"€"+u(a(y)),1)]),a(l)?(m(),d("div",H,[...e[2]||(e[2]=[t("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary_button_color mb-4"},null,-1),t("p",{class:"text-sm text-text_color"},"Loading payment form...",-1)])])):w("",!0),h(t("div",J,null,512),[[P,!a(l)]]),h(t("button",{id:"submit",type:"submit",disabled:a(n),class:M(["w-full btn",a(n)?"btn--disabled":"btn--primary"])},[a(n)?(m(),d("div",U,[...e[3]||(e[3]=[t("div",{class:"spinner w-5 h-5 border-2 border-background_color border-t-transparent rounded-full animate-spin"},null,-1),t("span",{class:"btn__text"},"Processing...",-1)])])):(m(),d("span",W,"Pay €"+u(a(y)),1)),e[4]||(e[4]=t("span",{class:"btn__fill"},null,-1))],10,K),[[P,!a(l)]]),a(r)?(m(),d("div",X,[t("div",G,[e[5]||(e[5]=t("svg",{class:"w-5 h-5 text-error_text_color flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),t("p",Q,u(a(r)),1)])])):w("",!0)],32),e[6]||(e[6]=I('<div class="text-center space-y-2"><div class="flex items-center justify-center gap-2 text-success_text_color"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path></svg><p class="text-sm text-text_color font-medium">Secure payment powered by Stripe</p></div><p class="text-xs text-text_color">All transactions are encrypted and secure</p></div>',1))])])}}});export{ne as default};
