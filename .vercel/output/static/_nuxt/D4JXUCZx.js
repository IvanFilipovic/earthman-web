import{d as P,e as C,f as L}from"#entry";import{_ as z}from"./CBhFnRZX.js";import{C as B,k as _,b as x,D,F as i,N as E,a3 as t,ae as V,a4 as m,J as r,a7 as v,a9 as g,aa as w,a8 as N,X as c}from"./DY7e6STM.js";import"./BlJWFypG.js";import"./mbTednRk.js";import"./CeOnvSk8.js";const A={class:"min-h-screen bg-background_color"},M={class:"max-w-2xl mx-auto px-4 py-12"},R={class:"mb-8"},j={class:"text-sm text-text_color/70"},F={class:"flex justify-between items-center mb-8 pb-6 border-b border-text_color/30"},T={class:"text-3xl font-semibold text-text_color"},q={key:0,class:"flex flex-col items-center justify-center py-20"},I={id:"payment-element",class:"mb-6"},$=["disabled"],H={key:0,class:"flex items-center justify-center gap-2"},O={key:1,class:"btn__text"},J={key:1,id:"payment-message",class:"mt-4 p-4 bg-error_text_color/10 border border-error_text_color rounded"},K={class:"flex items-start gap-2"},W={class:"text-sm text-error_text_color"},re=B({__name:"card",setup(X){const u=P(),y=_(()=>u.query.clientSecret),b=_(()=>u.query.ref),p=_(()=>u.query.amount),n=x(!1),o=x(""),a=x(!0);let l=null,d=null;async function h(){if(!y.value){o.value="Invalid payment session",a.value=!1;return}if(!(typeof window>"u"))try{const{loadStripe:s}=await C(async()=>{const{loadStripe:S}=await import("./CuE7ILBx.js");return{loadStripe:S}},[],import.meta.url),e=L();if(l=await s(e.public.stripePublishableKey),!l)throw new Error("Failed to load Stripe");const f={theme:"stripe",variables:{colorPrimary:"#0040ff",colorBackground:"#e2e2e2",colorText:"#252525",colorDanger:"#C90D00",fontFamily:"system-ui, sans-serif",borderRadius:"4px"},rules:{".Input":{border:"1px solid rgba(37, 37, 37, 0.3)",padding:"12px",marginBottom:"8px"},".Label":{fontSize:"12px",fontWeight:"500",textTransform:"uppercase"}}};d=l.elements({clientSecret:y.value,appearance:f}),d.create("payment",{layout:"tabs"}).mount("#payment-element"),a.value=!1}catch(s){console.error("❌ Error:",s),o.value=s.message||"Failed to load payment form",a.value=!1}}async function k(s){if(s.preventDefault(),!l||!d){o.value="Payment system not ready";return}n.value=!0,o.value="";try{const{error:e}=await l.confirmPayment({elements:d,confirmParams:{return_url:`${window.location.origin}/thank-you?ref=${b.value}&total=${p.value}`}});e&&(e.type==="card_error"||e.type==="validation_error"?o.value=e.message:o.value="An unexpected error occurred.")}catch(e){o.value="Payment failed. Please try again.",console.error("Payment error:",e)}finally{n.value=!1}}return D(()=>{h()}),(s,e)=>{const f=z;return c(),i("section",A,[E(f,{dark:!1}),t("div",M,[t("div",R,[e[0]||(e[0]=t("h1",{class:"text-2xl uppercase tracking-widest mb-2 text-text_color"},"Complete Payment",-1)),t("p",j,"Order: "+m(r(b)),1)]),t("form",{id:"payment-form",onSubmit:k,class:"border border-text_color/30 p-6 md:p-8 mb-6"},[t("div",F,[e[1]||(e[1]=t("span",{class:"text-sm uppercase tracking-widest text-text_color font-medium"},"Total Amount",-1)),t("span",T,"€"+m(r(p)),1)]),r(a)?(c(),i("div",q,[...e[2]||(e[2]=[t("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary_button_color mb-4"},null,-1),t("p",{class:"text-sm text-text_color"},"Loading payment form...",-1)])])):v("",!0),g(t("div",I,null,512),[[w,!r(a)]]),g(t("button",{id:"submit",type:"submit",disabled:r(n),class:N(["w-full btn",r(n)?"btn--disabled":"btn--primary"])},[r(n)?(c(),i("div",H,[...e[3]||(e[3]=[t("div",{class:"spinner w-5 h-5 border-2 border-background_color border-t-transparent rounded-full animate-spin"},null,-1),t("span",{class:"btn__text"},"Processing...",-1)])])):(c(),i("span",O,"Pay €"+m(r(p)),1)),e[4]||(e[4]=t("span",{class:"btn__fill"},null,-1))],10,$),[[w,!r(a)]]),r(o)?(c(),i("div",J,[t("div",K,[e[5]||(e[5]=t("svg",{class:"w-5 h-5 text-error_text_color flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),t("p",W,m(r(o)),1)])])):v("",!0)],32),e[6]||(e[6]=V('<div class="text-center space-y-2"><div class="flex items-center justify-center gap-2 text-success_text_color"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path></svg><p class="text-sm text-text_color font-medium">Secure payment powered by Stripe</p></div><p class="text-xs text-text_color">All transactions are encrypted and secure</p></div>',1))])])}}});export{re as default};
